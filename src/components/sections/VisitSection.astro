---
import { Image } from 'astro:assets';
import heroImage1 from '@assets/images/donation.jpg';
import heroImage2 from '@assets/images/donation.jpg';
import heroImage3 from '@assets/images/donation.jpg';
---

<section class="relative py-24 overflow-hidden" aria-labelledby="visit-title">
    <!-- Contenedor principal -->
    <div class="relative max-w-7xl mx-auto px-6 lg:px-8">
        <div class="grid lg:grid-cols-2 gap-12 lg:gap-16 items-start">
            <!-- Columna izquierda: Contenido -->
            <div class="relative space-y-8 bg-white p-8 rounded-2xl shadow-sm">
                <div class="space-y-6">
                    <span class="inline-flex items-center px-3 py-1.5 rounded-full bg-[#800020]/10 text-[#800020] text-sm font-medium">
                        Visítanos
                    </span>
                    
                    <h1 id="visit-title" class="text-4xl lg:text-5xl font-bold text-gray-900 leading-tight">
                        Bienvenidos al Colegio 
                        <span class="relative whitespace-nowrap text-[#800020]">
                            <svg aria-hidden="true" viewBox="0 0 418 42" class="absolute left-0 top-full h-[0.4em] w-full fill-[#800020]/20" preserveAspectRatio="none">
                                <path d="M203.371.916c-26.013-2.078-76.686 1.963-124.73 9.946L67.3 12.749C35.421 18.062 18.2 21.766 6.004 25.934 1.244 27.561.828 27.778.874 28.61c.07 1.214.828 1.121 9.595-1.176 9.072-2.377 17.15-3.92 39.246-7.496C123.565 7.986 157.869 4.492 195.942 5.046c7.461.108 19.25 1.696 19.17 2.582-.107 1.183-7.874 4.31-25.75 10.366-21.992 7.45-35.43 12.534-36.701 13.884-2.173 2.308-.202 4.407 4.442 4.734 2.654.187 3.263.157 15.593-.78 35.401-2.686 57.944-3.488 88.365-3.143 46.327.526 75.721 2.23 130.788 7.584 19.787 1.924 20.814 1.98 24.557 1.332l.066-.011c1.201-.203 1.53-1.825.399-2.335-2.911-1.31-4.893-1.604-22.048-3.261-57.509-5.556-87.871-7.36-132.059-7.842-23.239-.254-33.617-.116-50.627.674-11.629.54-42.371 2.494-46.696 2.967-2.359.259 8.133-3.625 26.504-9.81 23.239-7.825 27.934-10.149 28.304-14.005.417-4.348-3.529-6-16.878-7.066Z" />
                            </svg>
                            <span class="relative">CNSV</span>
                        </span>
                    </h1>
                </div>
                
                <p class="text-lg text-gray-600 leading-relaxed">
                    Descubre nuestra misión y valores que guían la educación de calidad que ofrecemos a nuestros estudiantes.
                </p>

                <!-- Características -->
                <div class="grid grid-cols-3 gap-4 pt-6">
                    <div class="text-center space-y-2">
                        <span class="inline-block p-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-[#800020]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 14l9-5-9-5-9 5 9 5z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 14l9-5-9-5-9 5 9 5z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 14l9-5-9-5-9 5 9 5z"/>
                            </svg>
                        </span>
                        <h3 class="text-sm font-semibold text-gray-900">EXCELENCIA ACADÉMICA</h3>
                    </div>
                    <div class="text-center space-y-2">
                        <span class="inline-block p-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-[#800020]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                            </svg>
                        </span>
                        <h3 class="text-sm font-semibold text-gray-900">AMBIENTE SEGURO</h3>
                    </div>
                    <div class="text-center space-y-2">
                        <span class="inline-block p-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-[#800020]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064"/>
                            </svg>
                        </span>
                        <h3 class="text-sm font-semibold text-gray-900">PERSPECTIVA GLOBAL</h3>
                    </div>
                </div>
            </div>

            <!-- Columna derecha: Carrusel con efecto de gradiente -->
            <div class="relative h-full">
                <!-- Contenedor del carrusel -->
                <div class="relative overflow-hidden h-full" id="carousel-container">
                    <!-- Gradientes laterales -->
                    <div class="absolute left-0 top-0 w-[33.33%] h-full bg-gradient-to-r from-white to-transparent z-20"></div>
                    <div class="absolute right-0 top-0 w-[33.33%] h-full bg-gradient-to-l from-white to-transparent z-20"></div>
                    
                    <!-- Track del carrusel -->
                    <div class="flex h-full transition-transform duration-500 ease-in-out" id="carousel-track">
                        {[heroImage1, heroImage2, heroImage3, heroImage1, heroImage2].map((image, index) => (
                            <div class="w-1/3 flex-shrink-0">
                                <div class="relative h-full group px-2">
                                    <div class="h-[calc(100vh-25rem)] min-h-[500px] rounded-2xl overflow-hidden">
                                        <Image
                                            src={image}
                                            alt={`Vista del campus ${index + 1}`}
                                            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                                            loading={index === 0 ? "eager" : "lazy"}
                                            width={800}
                                            height={500}
                                        />
                                        <!-- Overlay oscuro en hover -->
                                        <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                                        <!-- Título de la imagen -->
                                        <div class="absolute bottom-0 left-0 right-0 p-6 text-white transform translate-y-full group-hover:translate-y-0 transition-transform duration-300">
                                            <h3 class="text-xl font-semibold">Educación de Calidad</h3>
                                            <p class="text-sm text-white/90">Nuestro compromiso con la excelencia</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
const initCarousel = () => {
    const track = document.getElementById('carousel-track');
    const slides = track?.children;
    
    if (!track || !slides.length) return;

    let currentIndex = 1; // Comenzamos desde la segunda imagen
    const slideCount = slides.length;

    const updateSlidePosition = () => {
        const slideWidth = (track.parentElement?.offsetWidth || 0) / 3;
        const offset = -currentIndex * slideWidth;
        track.style.transform = `translateX(${offset}px)`;
    };

    const moveToSlide = (index: number) => {
        currentIndex = index;
        updateSlidePosition();
        
        // Si llegamos al final, reseteamos al inicio sin animación
        if (currentIndex >= slideCount - 1) {
            setTimeout(() => {
                track.style.transition = 'none';
                currentIndex = 1;
                updateSlidePosition();
                setTimeout(() => {
                    track.style.transition = 'transform 500ms ease-in-out';
                }, 50);
            }, 500);
        }
        // Si llegamos al inicio, reseteamos al final sin animación
        else if (currentIndex <= 0) {
            setTimeout(() => {
                track.style.transition = 'none';
                currentIndex = slideCount - 2;
                updateSlidePosition();
                setTimeout(() => {
                    track.style.transition = 'transform 500ms ease-in-out';
                }, 50);
            }, 500);
        }
    };

    // Autoplay
    let autoplayInterval: number;
    
    const startAutoplay = () => {
        autoplayInterval = setInterval(() => {
            moveToSlide(currentIndex + 1);
        }, 5000) as unknown as number;
    };

    const stopAutoplay = () => {
        clearInterval(autoplayInterval);
    };

    // Eventos para detener/reanudar autoplay
    track.addEventListener('mouseenter', stopAutoplay);
    track.addEventListener('mouseleave', startAutoplay);

    // Responsive handling
    window.addEventListener('resize', updateSlidePosition);

    // Initial setup
    updateSlidePosition();
    startAutoplay();

    // Cleanup
    return () => {
        window.removeEventListener('resize', updateSlidePosition);
        clearInterval(autoplayInterval);
    };
};

document.addEventListener('astro:page-load', initCarousel);
</script>

<style>
@media (prefers-reduced-motion: reduce) {
    .transition-transform,
    .transition-opacity,
    .group-hover\:scale-105,
    .group-hover\:opacity-100,
    .group-hover\:translate-y-0 {
        transition: none !important;
        transform: none !important;
    }
}

#carousel-track {
    backface-visibility: hidden;
    transform: translateZ(0);
    will-change: transform;
}
</style>